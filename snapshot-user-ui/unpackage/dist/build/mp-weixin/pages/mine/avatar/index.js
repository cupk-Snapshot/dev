(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/mine/avatar/index"],{"0387":function(t,e,a){"use strict";a.d(e,"b",(function(){return c})),a.d(e,"c",(function(){return i})),a.d(e,"a",(function(){}));var c=function(){var t=this.$createElement;this._self._c},i=[]},"2e23":function(t,e,a){"use strict";a.r(e);var c=a("0387"),i=a("eb4b");for(var u in i)["default"].indexOf(u)<0&&function(t){a.d(e,t,(function(){return i[t]}))}(u);a("537e");var r=a("f0c5"),s=Object(r["a"])(i["default"],c["b"],c["c"],!1,null,null,null,!1,c["a"],void 0);e["default"]=s.exports},"537e":function(t,e,a){"use strict";var c=a("bb2d"),i=a.n(c);i.a},"5f9c":function(t,e,a){"use strict";(function(t,e){var c=a("4ea4");a("7f78");c(a("66fd"));var i=c(a("2e23"));t.__webpack_require_UNI_MP_PLUGIN__=a,e(i.default)}).call(this,a("bc2e")["default"],a("543d")["createPage"])},bb2d:function(t,e,a){},eb4b:function(t,e,a){"use strict";a.r(e);var c=a("ee7b"),i=a.n(c);for(var u in c)["default"].indexOf(u)<0&&function(t){a.d(e,t,(function(){return c[t]}))}(u);e["default"]=i.a},ee7b:function(t,e,a){"use strict";(function(t){var c=a("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i,u,r,s,n,o,h,p,f,d,l=c(a("0f97")),g=c(a("de71")),v=a("7874"),m=l.default.baseUrl,b=t.getSystemInfoSync(),T=b.screenWidth,I=(b.pixelRatio,100),L=b.screenWidth,R={data:function(){return{imageSrc:g.default.getters.avatar,isShowImg:!1,cropperInitW:T,cropperInitH:T,cropperW:T,cropperH:T,cropperL:0,cropperT:0,transL:0,transT:0,scaleP:0,imageW:0,imageH:0,cutL:0,cutT:0,cutB:T,cutR:"100%",qualityWidth:L,innerAspectRadio:1}},onReady:function(){this.loadImage()},methods:{setData:function(t){var e=this;Object.keys(t).forEach((function(a){e.$set(e.$data,a,t[a])}))},getImage:function(){var e=this;t.chooseImage({success:function(t){e.setData({imageSrc:t.tempFilePaths[0]}),e.loadImage()}})},loadImage:function(){var e=this;t.getImageInfo({src:e.imageSrc,success:function(a){1,f=T,d=T/1;var c=f>d?f:d;I=c>I?I:c;var i=Math.ceil((T/1-(T/1-I))/2),u=i,r=Math.ceil((T-T+I)/2),s=r;e.setData({cropperW:T,cropperH:T/1,cropperL:Math.ceil((T-T)/2),cropperT:Math.ceil((T-T/1)/2),cutL:r,cutT:i,cutR:s,cutB:u,imageW:f,imageH:d,scaleP:f/T,qualityWidth:L,innerAspectRadio:1}),e.setData({isShowImg:!0}),t.hideLoading()}})},contentStartMove:function(t){i=t.touches[0].pageX,u=t.touches[0].pageY},contentMoveing:function(t){var e=1*(i-t.touches[0].pageX),a=1*(u-t.touches[0].pageY);e>0?this.cutL-e<0&&(e=this.cutL):this.cutR+e<0&&(e=-this.cutR),a>0?this.cutT-a<0&&(a=this.cutT):this.cutB+a<0&&(a=-this.cutB),this.setData({cutL:this.cutL-e,cutT:this.cutT-a,cutR:this.cutR+e,cutB:this.cutB+a}),i=t.touches[0].pageX,u=t.touches[0].pageY},contentTouchEnd:function(){},getImageInfo:function(){var e=this;t.showLoading({title:"图片生成中..."});var a=t.createCanvasContext("myCanvas");a.drawImage(e.imageSrc,0,0,f,d),a.draw(!0,(function(){var a=(e.cropperW-e.cutL-e.cutR)/e.cropperW*f,c=(e.cropperH-e.cutT-e.cutB)/e.cropperH*d,i=e.cutL/e.cropperW*f,u=e.cutT/e.cropperH*d;t.canvasToTempFilePath({x:i,y:u,width:a,height:c,destWidth:a,destHeight:c,quality:.5,canvasId:"myCanvas",success:function(e){t.hideLoading();var a={name:"avatarfile",filePath:e.tempFilePath};(0,v.uploadAvatar)(a).then((function(e){g.default.commit("SET_AVATAR",m+e.imgUrl),t.showToast({title:"修改成功",icon:"success"}),t.navigateBack()}))}})}))},dragStart:function(t){r=t.touches[0].pageX,s=t.touches[0].pageY,n=this.cutL,h=this.cutR,p=this.cutB,o=this.cutT},dragMove:function(t){var e=t.target.dataset.drag;switch(e){case"right":var a=1*(r-t.touches[0].pageX);h+a<0&&(a=-h),this.setData({cutR:h+a});break;case"left":a=1*(r-t.touches[0].pageX);n-a<0&&(a=n),n-a>this.cropperW-this.cutR&&(a=n-(this.cropperW-this.cutR)),this.setData({cutL:n-a});break;case"top":a=1*(s-t.touches[0].pageY);o-a<0&&(a=o),o-a>this.cropperH-this.cutB&&(a=o-(this.cropperH-this.cutB)),this.setData({cutT:o-a});break;case"bottom":a=1*(s-t.touches[0].pageY);p+a<0&&(a=-p),this.setData({cutB:p+a});break;case"rightBottom":var c=1*(r-t.touches[0].pageX),i=1*(s-t.touches[0].pageY);p+i<0&&(i=-p),h+c<0&&(c=-h);var u=p+i,f=h+c;this.setData({cutB:u,cutR:f});break;default:break}}}};e.default=R}).call(this,a("543d")["default"])}},[["5f9c","common/runtime","common/vendor"]]]);